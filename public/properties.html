<!DOCTYPE html>
<html>

<head>
    <script>
        let xmlDoc;
        let propertiesPerPage = 20;
        let currentPage = 1;

        async function loadDataFromXML() {
            try {
                const response = await fetch("https://luxury-palmeras-5b89d300db8d.herokuapp.com/proxy-xml");
                const xmlText = await response.text();
                const parser = new DOMParser();
                xmlDoc = parser.parseFromString(xmlText, "text/xml");
                if (!xmlDoc || xmlDoc.getElementsByTagName("parsererror").length) {
                    console.error("Failed to parse XML.");
                    return;
                }

                displayResult();
            } catch (error) {
                console.error("Error loading or parsing XML:", error);
            }
        }

        function loadXMLDoc(filename) {
            let xhttp = new XMLHttpRequest();
            xhttp.open("GET", filename, false);
            xhttp.send("");
            const xmlResponse = xhttp.responseXML;

            if (!xmlResponse) {
                console.error("Failed to load XSLT.");
            }

            return xmlResponse;
        }

        function displayResult() {
            if (!xmlDoc) {
                console.error("XML document not loaded");
                return;
            }

            let xsl = loadXMLDoc("properties.xslt");
            if (!xsl) {
                console.error("XSLT document not loaded");
                return;
            }

            let xsltProcessor = new XSLTProcessor();
            xsltProcessor.importStylesheet(xsl);

            // Set parameters for pagination
            xsltProcessor.setParameter(null, "propertiesPerPage", propertiesPerPage);
            xsltProcessor.setParameter(null, "currentPage", currentPage);

            let resultDocument = xsltProcessor.transformToFragment(xmlDoc, document);

            if (resultDocument && resultDocument.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
                document.getElementById("example").innerHTML = ""; // Clear previous content
                document.getElementById("example").appendChild(resultDocument);
            } else {
                console.error("Transformation did not produce a valid document fragment.");
            }

            updatePaginationControls();
        }


        function updatePaginationControls() {
            let totalProperties = xmlDoc.getElementsByTagName("property").length;
            let totalPages = Math.ceil(totalProperties / propertiesPerPage);
            let paginationContainer = document.getElementById("pagination");

            paginationContainer.innerHTML = ""; // Clear previous buttons

            for (let i = 1; i <= totalPages; i++) {
                let pageButton = document.createElement("button");
                pageButton.innerText = i;
                pageButton.className = i === currentPage ? "active" : "";
                pageButton.onclick = () => {
                    currentPage = i;
                    displayResult();
                };
                paginationContainer.appendChild(pageButton);
            }
        }
    </script>
</head>

<body window.onload="loadDataFromXML()">
    <div id="example"></div>
    <div id="pagination" class="pagination"></div>
</body>

</html>