<!DOCTYPE html>
<html lang="nl">
<head>
    <title>Luxury Palmeras - Luxury Properties</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- Web analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug getPageViewId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_UNm11m2pPVK8c2MoFp7bPnUAhXH55Mo11cFgixCS0nW', {
            api_host:'https://us.i.posthog.com',
            person_profiles: 'identified_only' // or 'always' to create profiles for anonymous users as well
        })
    </script>
    <!-- translate -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'nl', includedLanguages:
        'en,es,de,fr',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE, autoDisplay:
        false}, 'google_translate_element');
        }
    </script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <div class="sticky-top" id="google_translate_element"></div>
</head>
<body>
    <div id="loading-overlay"
        class="d-flex flex-column justify-content-center align-items-center position-fixed top-0 start-0 w-100 h-100 bg-white"
        style="z-index: 1050;">
        <div class="spinner-border text-secondary mb-3" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mb-3 text-secondary fw-bold">Page is loading...</p>
        <div class="progress w-50 bg-secondary">
            <div id="progress-bar" class="progress-bar bg-dark progress-bar-striped" role="progressbar" style="width: 0%;"
                aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
    </div>
    <nav class="navbar navbar-light navbar-expand-lg bg-white text-white pb-4 m-auto fs-4" id="navigation">
        <div class="container-fluid" id="navigation">
            <a class="navbar-brand h3 text-black align-middle" href="index.html">
                <img src="images/LP-icon.png" class="image-responsive d-inline-block align-middle" width="40" height="40" alt="Logo" />
                Luxury Palmeras </a>
            <div class="nav align-items-end px-2">
                <button class="navbar-toggler ml-2 pl-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse " id="navbarNavDropdown">
                    <ul class="navbar-nav pull-left">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="Luxury invest.html">Luxury
                                Invest</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="properties.html">Luxury
                                Properties</a>
                        </li>
                        <li class="nav-item" id="menu">
                            <a class="nav-link" href="houses.html" aria-expanded="false">Luxury Rentals</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="keyholding.html">
                                Keyholding</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">Over ons</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <div class="container-fluid">
        <!-- Header -->
        <div class="row px-5">
            <div class="col-12 text-center fw-bold m-auto pb-3">
                <h1>Woningen te koop in Spanje</h1>
            </div>
        </div>
        <!-- Filters -->
        <div id="filters">
            <!-- Dropdown for Sorting -->
            <div class="sorting-container">
                <div class="row px-5">
                    <div class="col-6 text-center fw-bold m-auto pb-3">
                        <div class="mb-3">
                            <label for="sortDropdown">Sorteer op:</label>
                            <select id="sortDropdown" onchange="applySort()" class="form-control">
                                <option value="none">-- Select --</option>
                                <option value="price_asc">Prijs (Laag naar Hoog)</option>
                                <option value="price_desc">Prijs (Hoog naar Laag)</option>
                                <option value="surface_area_asc">Woning Oppervlakte (Klein naar Groot)</option>
                                <option value="surface_area_desc">Woning Oppervlakte (Groot naar Klein)</option>
                                <option value="plot_area_asc">Tuin Oppervlakte (Klein naar Groot)</option>
                                <option value="plot_area_desc">Tuin Oppervlakte (Groot naar Klein)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Navbar with Filters -->
            <nav class="navbar navbar-expand-md navbar-light">
                <!-- Hamburger button -->
                <button class="navbar-toggler text-center m-auto" type="button" data-bs-toggle="collapse" data-bs-target="#filterMenu" aria-controls="filterMenu" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon "></span>
                    <p class="fw-bold pt-2">Filters</p>
                </button>
                <!-- Collapsible Filter Section -->
                <div class="collapse navbar-collapse" id="filterMenu">
                    <!-- Filters for Slaapkamers, Badkamers, Zwembaden, and Type Woning -->
                    <div class="row px-5 fw-bold text-center m-auto flex-wrap">
                        <div class="col">
                            <div class="mb-3">
                                <label>Filter op Slaapkamers:</label>
                                <br />
                                <button id="beds-2" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'beds', 2)">2 Slaapkamers</button>
                                <button id="beds-3" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'beds', 3)">3 Slaapkamers</button>
                                <button id="beds-4" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'beds', 4)">4 Slaapkamers</button>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label>Filter op Badkamers:</label>
                                <br />
                                <button id="baths-1" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'baths', 1)">1 Badkamer</button>
                                <button id="baths-2" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'baths', 2)">2 Badkamers</button>
                                <button id="baths-3" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'baths', 3)">3 Badkamers</button>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label>Filter op Zwembaden:</label>
                                <br />
                                <button id="pool-1" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'pool', 1)">Met Zwembad</button>
                                <button id="pool-0" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'pool', 0)">Zonder Zwembad</button>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label>Filter op Type Woning:</label>
                                <br />
                                <button id="type-Villa" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'type', 'Villa')">Villa</button>
                                <button id="type-Apartment" class="btn btn-light m-1 col" onclick="toggleFilter(this, 'type', 'Apartment')">Appartement</button>
                            </div>
                        </div>
                        <!-- Price Range Filters -->
                        <div class="col">
                            <div class="mb-3">
                                <label>Prijs klasse:</label>
                                <br />
                                <button class="btn btn-light filter-btn m-1 col" id="price-below_100k" onclick="toggleFilter(this, 'price', 'below_100k')">Onder 100k</button>
                                <button class="btn btn-light filter-btn m-1 col" id="price-100k_150k" onclick="toggleFilter(this, 'price', '100k_150k')">100k tot 150k</button>
                                <button class="btn btn-light filter-btn m-1 col" id="price-150k_200k" onclick="toggleFilter(this, 'price', '150k_200k')">150k tot 200k</button>
                                <button class="btn btn-light filter-btn m-1 col" id="price-200k_300k" onclick="toggleFilter(this, 'price', '200k_300k')">200k tot 300k</button>
                                <button class="btn btn-light filter-btn m-1 col" id="price-300k_500k" onclick="toggleFilter(this, 'price', '300k_500k')">300k tot 500k</button>
                                <button class="btn btn-light filter-btn m-1 col" id="price-above_500k" onclick="toggleFilter(this, 'price', 'above_500k')">Boven 500k</button>
                            </div>
                        </div>
                        <!-- New Filter: Reference Search Bar -->
                        <div class="col">
                            <div class="mb-3">
                            <label>Zoek op Referentie:</label>
                            <input
                                type="text"
                                id="refSearch"
                                class="form-control"
                                placeholder="Voer referentie in"
                                oninput="updateRefFilter(this)"
                            />
                            </div>
                        </div>
                        <!-- New Filter: Province Dropdown -->
                        <div class="col">
                            <div class="mb-3">
                            <label>Filter op Regio:</label>
                            <select id="provinceFilter" class="form-control" onchange="updateProvinceFilter(this)">
                                <!-- The options will be populated dynamically -->
                            </select>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Reset Filters Button -->
            <div class="row px-5 fw-bold m-auto pb-3 text-center">
                <div class="col col-12 col-md-12 col-lg-12">
                    <div class="mb-3">
                        <button class="btn btn-secondary mt-2" onclick="clearFilters()">Reset Filters</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Property List -->
        <div class="property-list row row-cols-lg-3 row-cols-md-2 row-cols-1 g-5 p-5" id="property-list">
        </div>            

        <!-- Pagination -->
        <div id="pagination-bottom" class="pagination-container text-center py-4"></div>
    </div>
    <!-- contact -->
    <div class="container-fluid px-5 pb-4" id="contact">
        <div class="row py-1 g-3 mx-auto">
            <div class="col-12 text-center">
                <h1>Contact</h1>
            </div>
            <div class="col-lg-2 col-md-4 col-6 mx-auto text-center">
                <a class="text-decoration-none text-body fw-bold" target="_blank" href="https://g.co/kgs/XPHsQeV">
                    <i class="bi bi-geo-alt-fill h3"></i><br>Carrer de Germanies 10<br>
                    03111 Busot<br>Alicante, Spain</a>
            </div>
            <div class="col-lg-2 col-md-4 col-6 p-1 m-auto text-center">
                <a class="text-decoration-none text-body fw-bold" target="_blank" href="https://wa.me/+34608205493">
                    <i class="bi bi-whatsapp h3"></i><br>+34608205493</a>
            </div>
            <div class="col-lg-2 col-md-4 col-6 p-1 m-auto text-center">
                <a class="text-decoration-none text-body fw-bold" target="_blank"
                    href="https://www.linkedin.com/company/luxury-palmeras/">
                    <i class="bi bi-linkedin h3"></i><br>LinkedIn</a>
            </div>
            <div class="col-lg-2 col-md-4 col-6 p-1 m-auto text-center">
                <a class="text-decoration-none text-body fw-bold" target="_blank" href="" data-bs-toggle="modal" data-bs-target="#modalContactForm">
                    <i class="bi bi-envelope-at-fill h3"></i><p>Mike<br>@Luxurypalmeras.com</p></a>
            </div>
            <div class="col-lg-2 col-md-4 col-6 p-1 m-auto text-center">
                <a class="text-decoration-none text-body fw-bold" target="_blank"
                    href="https://www.facebook.com/profile.php?id=100094585713462">
                    <i class="bi bi-facebook h3"></i><br>Facebook<br>@luxury Palmeras</a>
            </div>
            <div class="col-lg-2 col-md-4 col-6 p-1 m-auto text-center">
                <a class="text-decoration-none text-body fw-bold" target="_blank"
                    href="https://www.instagram.com/luxurypalmeras/">
                    <i class="bi bi-instagram h3"></i><br>Instagram<br>@luxurypalmeras</a>
            </div>
        </div>
    </div>
    <!-- contact form -->
    <div class="modal fade" id="modalContactForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Bericht ons!</h4>
                    <button type="button" class="close btn btn-unique border-0" data-bs-dismiss="modal"
                        aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form class="needs-validation" id="contactForm" onsubmit="validateContactForm()" method="POST"
                    name="myemailform" action="https://formspree.io/f/mqkrdvjb">
                    <div class="modal-body mx-3">
                        <div class="md-form mb-3">
                            <i class="fas fa-user prefix grey-text"></i>
                            <label data-error="wrong" data-success="right" for="naam">Uw naam</label>
                            <input type="text" id="naam" class="form-control validate" name="name" required=""
                                placeholder="Voor- en achternaam">
                        </div>
                        <div class="md-form mb-3">
                            <i class="fas fa-envelope prefix grey-text"></i>
                            <label data-error="wrong" data-success="right" for="form29">Uw email address</label>
                            <input type="email" id="form29" class="form-control validate" aria-describedby="emailHelp"
                                name="email" required>
                            <div id="emailHelp" class="form-text">Wij delen u email niet met derden.</div>
                        </div>
                        <div class="md-form mb-3">
                            <i class="fas fa-tag prefix grey-text"></i>
                            <label data-error="wrong" data-success="right" for="telefoon">Telefoonnummer</label>
                            <input type="telephone" id="telefoon" class="form-control validate" name="telefoon"
                                placeholder="(+316) 123-4567" required>
                        </div>
                        <div class="md-form mb-3">
                            <input type="hidden" id="form32" class="form-control validate" name="_subject"
                                value="Contact Form Submission">
                        </div>
                        <div class="md-form">
                            <i class="fas fa-pencil prefix grey-text"></i>
                            <label data-error="wrong" data-success="right" for="form8" required>Uw bericht:</label>
                            <textarea type="text" id="form8" class="md-textarea form-control" rows="4" name="message"
                                required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button type="submit" class="btn btn-dark" onclick="validateContactForm()"
                            data-bs-target="#verstuurd" value="send">Verstuur
                            <i class="fas fa-paper-plane-o ml-1"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="verstuurd" aria-hidden="true" aria-labelledby="verstuurd" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="verstuurd">Bedankt!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Uw ontvangt spoeding een reactie van ons.
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container-fluid pt-1 border-top">
            <div class="row m-auto fw-bold">
                <p>&copy; 2023 Luxury Palmeras. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script>

        window.onload = async function () {
            const loadingOverlay = document.getElementById("loading-overlay");

            console.log("Initializing page...");
            await initializePage(); // Wait for page initialization to complete
            console.log("Page initialized.");

            if (loadingOverlay) {
                loadingOverlay.style.setProperty("display", "none", "important");
            }
        };

        let currentFilter = {};
        let propertiesPerPage = 9;
        let currentPage = 1;
        let currentSort = 'none';  // Default to no sorting initially
        let cachedProperties = [];

        async function initializePage() {
            const progressBar = document.getElementById("progress-bar");

            try {
            console.log("Starting initialization...");

            // Step 1: Load JSON data
            console.log("Loading JSON data...");
            progressBar.style.width = "50%";
            progressBar.setAttribute("aria-valuenow", "50");
            cachedProperties = await loadDataFromJSON(); // Fetch and process JSON data
            
            // Now populate the province dropdown dynamically
            populateProvinceDropdown();
            
            // Step 2: Display results
            console.log("Displaying results...");
            progressBar.style.width = "100%";
            progressBar.setAttribute("aria-valuenow", "100");
            await displayResult(); // Pass JSON data to display results

            console.log("Initialization complete.");
            } catch (error) {
                        console.error("Error during initialization:", error);
                    }
            }

        function renderProperties(properties) {
            const propertyList = document.getElementById("property-list");
            if (!propertyList) {
                console.error("Property list container not found.");
                return;
            }

            // Clear existing properties
            propertyList.innerHTML = "";

            properties.forEach((property) => {
                const images = Array.isArray(property.images?.image)
                    ? property.images.image
                    : property.images?.image
                    ? [property.images.image]
                    : [];

                const ref = property.ref || `property-${Math.random().toString(36).substr(2, 9)}`;
                const carouselItems = images.length
                    ? images.map((image, idx) => `
                        <div class="carousel-item ${idx === 0 ? 'active' : ''}">
                            <img src="${image.url}" class="property-carousel-image d-block w-100 rounded-top" loading="lazy" alt="Property Image ${image["@attributes"]?.id || ''}" />
                        </div>
                    `).join("")
                    : `
                        <div class="carousel-item active">
                            <div class="property-carousel-image-placeholder">No Image Available</div>
                        </div>
                    `;

                // Property Card HTML
                const propertyHTML = `
                <div class="col">
                    <div class="card h-100 property-card">
                        <!-- Carousel -->
                        <div id="${ref}-carousel" class="carousel slide carousel-fade card-img-top" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                ${carouselItems}
                            </div>
                            ${images.length ? `
                                <button class="carousel-control-prev" type="button" data-bs-target="#${ref}-carousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#${ref}-carousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            ` : ""}
                        </div>
                        <!-- Property Details -->
                        <div class="card-body pt-3 m-auto">
                            <h4 class="card-title">${property.type || "Property"} in ${property.town || "Unknown"}, ${property.province || "Unknown"}</h4>
                            <h5>Prijs: €${property.price || "N/A"}</h5>
                            <h6>Reference number: ${ref}</h6>
                            <ul class="h6 list-unstyled">
                                <li>${property.beds || "N/A"} Slaapkamers</li>
                                <li>${property.baths || "N/A"} Badkamers</li>
                                <li>${property.pool ? "Zwembad" : "Geen Zwembad"}</li>
                                <li>${property.surface_area?.built || "N/A"} m² Woning Oppervlakte</li>
                                <li>${property.surface_area?.plot || "N/A"} m² Tuin Oppervlakte</li>
                            </ul>
                        </div>
                        <div class="card-text text-center align-items-end py-3 m-auto">
                            <!-- Modal Button -->
                            <button type="button" class="btn btn-outline-secondary more-info-btn"
                                data-bs-toggle="modal"
                                data-bs-target="#${ref}-imageModal">
                                Meer informatie
                            </button>
                        </div>   
                        </div>
                    </div>
                </div>
                `;

                // Property Modal HTML
                const modalHTML = `
                    <div class="modal fade" id="${ref}-imageModal" aria-labelledby="${ref}-imageModalLabel" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <div class="text-start">
                                        <img src="images/LP-icon.png" class="image-responsive d-inline-block" width="40" height="40" alt="Logo" />
                                    </div>
                                    <div class=" m-auto">
                                        <h1 class="modal-title fs-5 fw-bold text-center m-auto" id="${ref}-imageModalLabel">
                                        ${property.type || "Property"} in ${property.town || "Unknown"}, ${property.province || "Unknown"}
                                        </h1>
                                    </div>
                                    <div class="text-end">
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <!-- Carousel inside Modal -->
                                    <div id="${ref}-modal-carousel" class="carousel slide carousel-fade " data-bs-ride="carousel">
                                        <div class="carousel-inner w-100 rounded display-block h-100 property-carousel-modal-image">
                                            ${carouselItems}
                                        </div>
                                        ${images.length ? `
                                            <button class="carousel-control-prev" type="button" data-bs-target="#${ref}-modal-carousel" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#${ref}-modal-carousel" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                        ` : ""}
                                    </div>
                                    <!-- Property Details -->
                                    <div class="text-center m-auto pb-3">
                                        <div class="row">
                                            <h4 class="fw-bold py-1">Prijs: €${property.price || "N/A"} ${property.currency || ""}</h4>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <h4>Kamers en oppervlakte</h4>
                                            </div>
                                            <div class="col">
                                                <h4>Hoogtepunten</h4>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <ul class="list-unstyled">
                                                    <li>${property.beds || "N/A"} Slaapkamers</li>
                                                    <li>${property.baths || "N/A"} Badkamers</li>
                                                    <li>${property.pool ? "Zwembad" : "Geen Zwembad"}</li>
                                                    <li>${property.surface_area?.built || "N/A"} m² Oppervlakte</li>
                                                    <li>${property.surface_area?.plot || "N/A"} m² Tuin Oppervlakte</li>
                                                    <li>${property.energy_rating?.consumption || "N/A"} Energie Label</li>
                                                </ul>
                                            </div>
                                            <div class="col">
                                                <ul class="list-unstyled">
                                                    ${
                                                        property.features?.feature
                                                            ? Array.isArray(property.features.feature)
                                                                ? property.features.feature.map((feature) => `<li>${feature}</li>`).join("")
                                                                : `<li>${property.features.feature}</li>`
                                                            : "<li>Geen hoogtepunten beschikbaar.</li>"
                                                    }
                                                </ul>
                                            </div>
                                            <div class="row pb-3">
                                                <h4 class="fw-bold">Omschrijving</h4>
                                                <h6>Reference number: ${ref}</h6>
                                                <p>${property.desc?.nl || "Geen beschrijving beschikbaar."}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Contact Button -->
                                    <div class="text-center m-auto pb-3">
                                        <button class="btn btn-outline-secondary text-center m-auto contact-btn"
                                            data-bs-target="#${ref}-modalContactForm"
                                            data-bs-toggle="modal">Neem contact met ons op!</button>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <p class="fs-6 text-start">In samenwerking met Gaudi Estate.
                                            Register van makelaars in onroerend goed:
                                            Valenciaanse Gemeenschap (RAICV) nr. 2714</p>
                                        <img src="images/gaudi_logo_hr-1.png"
                                            class="image-responsive d-inline-block" width="40"
                                            height="40" alt="Logo" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;

                // Contact Form Modal HTML
                const contactFormHTML = `
                <div class="modal fade" id="${ref}-modalContactForm" tabindex="-1" role="dialog" aria-labelledby="${ref}-contactModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header text-center">
                                <h4 class="modal-title w-100 font-weight-bold">Bericht ons!</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form class="needs-validation" id="contactFormHousing" method="POST" action="https://formspree.io/f/manyypgq">
                                <div class="modal-body mx-3">
                                    <div class="mb-3">
                                        <label for="name-${ref}" class="form-label">Uw naam</label>
                                        <input type="text" id="name-${ref}" class="form-control" name="name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email-${ref}" class="form-label">Uw email address</label>
                                        <input type="email" id="email-${ref}" class="form-control" name="email" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="subject-${ref}" class="form-label">Onderwerp</label>
                                        <input type="text" id="subject-${ref}" class="form-control" name="subject" value="Info ${property.type || ''} in ${property.town || ''}, ${property.province || ''} (${ref})" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="message-${ref}" class="form-label">Uw bericht</label>
                                        <textarea id="message-${ref}" class="form-control" rows="4" name="message" required></textarea>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button type="submit" class="btn btn-dark">Verstuur</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                `;

                // Append property card, main modal, and contact form modal to the list
                propertyList.innerHTML += propertyHTML + modalHTML + contactFormHTML;
            });
        }

        function setupEventListeners() {
            console.log("Attempting to add event listener to sortDropdown.");
            const sortDropdown = document.getElementById('sortDropdown');
            if (sortDropdown) {
                console.log("sortDropdown found.");
                sortDropdown.addEventListener('change', function () {
                    // Update the global sorter state
                    currentSort = this.value;
                    
                    // Reset to the first page when sorting changes
                    currentPage = 1; 

                    // Display the updated results with the new sorting
                    applySort();
                });
            } else {
                console.error("Sort dropdown element not found. Make sure the element ID is correct.");
            }
        }
    
        async function loadDataFromJSON() {
            try {
                // Use the correct server URL dynamically
                const serverURL = window.location.origin; // Automatically detects the current domain
                const response = await fetch(`${serverURL}/data.json`);

                if (!response.ok) {
                    throw new Error(`Failed to fetch JSON: ${response.statusText}`);
                }

                // Parse and return the JSON data
                const data = await response.json();
                console.log("JSON Data Loaded:", data);

                if (data && Array.isArray(data.property)) {
                    return data.property; // Return the properties directly
                } else {
                    console.error("Invalid JSON structure");
                    return [];
                }
                // return data;

            } catch (error) {
                console.error("Error loading JSON data:", error);
                throw error;
            }
        }

        async function displayResult() {
            try {
                 // Use cached data instead of fetching again
                const properties = cachedProperties;

                if (!Array.isArray(properties) || properties.length === 0) {
                    console.error("No valid properties found in JSON data");
                    return;
                }

                // Step 2: Apply filtering based on currentFilter
                const filteredProperties = properties.filter((property) => {
                    let showProperty = true;

                    for (let [attribute, value] of Object.entries(currentFilter)) {
                        let propertyValue;

                        if (attribute === "price") {
                            const price = parseInt(property.price || 0);
                            switch (value) {
                                case "below_100k":
                                    if (price >= 100000) showProperty = false;
                                    break;
                                case "100k_150k":
                                    if (price < 100000 || price > 150000) showProperty = false;
                                    break;
                                case "150k_200k":
                                    if (price < 150000 || price > 200000) showProperty = false;
                                    break;
                                case "200k_300k":
                                    if (price < 200000 || price > 300000) showProperty = false;
                                    break;
                                case "300k_500k":
                                    if (price < 300000 || price > 500000) showProperty = false;
                                    break;
                                case "above_500k":
                                    if (price <= 500000) showProperty = false;
                                    break;
                            }
                        } else if (attribute === "beds" || attribute === "baths") {
                            propertyValue = parseInt(property[attribute] || 0);
                            if (propertyValue !== parseInt(value)) {
                                showProperty = false;
                            }
                        } else if (attribute === "pool") {
                            propertyValue = parseInt(property.pool || 0);
                            if (propertyValue !== parseInt(value)) {
                                showProperty = false;
                            }
                        } else if (attribute === "type") {
                            propertyValue = property.type || "";
                            if (propertyValue.toLowerCase() !== value.toLowerCase()) {
                                showProperty = false;
                            }
                        } else if (attribute === "province") {
                            propertyValue = property.province || "";
                            // If the filter is not "all" and the property's province does not match, exclude it.
                            if (value.toLowerCase() !== "all" && propertyValue.toLowerCase() !== value.toLowerCase()) {
                                showProperty = false;
                            }
                        } else if (attribute === "ref") {
                            propertyValue = property.ref || "";
                            // Check if the property reference contains the search value (case-insensitive)
                            if (!propertyValue.toLowerCase().includes(value.toLowerCase())) {
                                showProperty = false;
                            }
                        }

                        if (!showProperty) break;
                    }

                    return showProperty;
                });

                // Step 3: Sort the filtered properties based on currentSort
                if (currentSort !== "none") {
                    filteredProperties.sort((a, b) => {
                        let aValue, bValue;
                        switch (currentSort) {
                            case "price_asc":
                                aValue = parseInt(a.price || 0);
                                bValue = parseInt(b.price || 0);
                                return aValue - bValue;
                            case "price_desc":
                                aValue = parseInt(a.price || 0);
                                bValue = parseInt(b.price || 0);
                                return bValue - aValue;
                            case "surface_area_asc":
                                aValue = parseInt(a.surface_area?.built || 0);
                                bValue = parseInt(b.surface_area?.built || 0);
                                return aValue - bValue;
                            case "surface_area_desc":
                                aValue = parseInt(a.surface_area?.built || 0);
                                bValue = parseInt(b.surface_area?.built || 0);
                                return bValue - aValue;
                            case "plot_area_asc":
                                aValue = parseInt(a.surface_area?.plot || 0);
                                bValue = parseInt(b.surface_area?.plot || 0);
                                return aValue - bValue;
                            case "plot_area_desc":
                                aValue = parseInt(a.surface_area?.plot || 0);
                                bValue = parseInt(b.surface_area?.plot || 0);
                                return bValue - aValue;
                            default:
                                return 0;
                        }
                    });
                }

                // Step 4: Apply pagination to the sorted, filtered list
                const totalProperties = filteredProperties.length;
                const startIndex = (currentPage - 1) * propertiesPerPage;
                const endIndex = currentPage * propertiesPerPage;
                const paginatedProperties = filteredProperties.slice(startIndex, endIndex);

                // Step 5: Render properties using renderProperties function
                renderProperties(paginatedProperties);

                // Step 6: Update pagination controls
                updatePaginationControls(totalProperties);

                // Step 7: Update filter button visuals
                for (let attribute in currentFilter) {
                    const value = currentFilter[attribute];
                    const button = document.querySelector(`button[id="${attribute}-${value}"]`);
                    if (button) {
                        button.classList.remove("btn-light");
                        button.classList.add("btn-secondary");
                    }
                }

                // Step 8: Update sorting dropdown to reflect the current sorting selection
                const sortDropdown = document.getElementById("sortDropdown");
                if (sortDropdown) {
                    sortDropdown.value = currentSort;
                }

                // Step 9: Initialize carousels and modals
                initializeCarousels();
                attachCarouselListeners();
                attachModalListeners();
                
                console.log("Results displayed successfully.");
            } catch (error) {
                console.error("Error rendering properties:", error);
            }
        }

        function updatePaginationControls(totalProperties) {
            const paginationBottomContainer = document.getElementById("pagination-bottom");

            // Calculate the total number of pages
            const totalPages = Math.ceil(totalProperties / propertiesPerPage);
            const maxVisiblePages = 10; // Maximum number of visible page buttons

            // Helper function to create pagination buttons
            function createPagination(container) {
                container.innerHTML = ""; // Clear previous pagination buttons

                const startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                const endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

                // Add "Previous" button
                if (currentPage > 1) {
                    const prevButton = document.createElement("button");
                    prevButton.innerText = "Previous";
                    prevButton.classList.add("pagination-button");
                    prevButton.onclick = () => {
                        currentPage--;
                        displayResult(); // Call displayResult to handle rendering
                    };
                    container.appendChild(prevButton);
                }

                // Add numbered page buttons
                for (let i = startPage; i <= endPage; i++) {
                    const pageButton = document.createElement("button");
                    pageButton.innerText = i;
                    pageButton.classList.add("pagination-button");
                    if (i === currentPage) {
                        pageButton.classList.add("active");
                    }
                    pageButton.onclick = () => {
                        currentPage = i;
                        displayResult(); // Call displayResult to handle rendering
                    };
                    container.appendChild(pageButton);
                }

                // Add "Next" button
                if (currentPage < totalPages) {
                    const nextButton = document.createElement("button");
                    nextButton.innerText = "Next";
                    nextButton.classList.add("pagination-button");
                    nextButton.onclick = () => {
                        currentPage++;
                        displayResult(); // Call displayResult to handle rendering
                    };
                    container.appendChild(nextButton);
                }
            }

            if (paginationBottomContainer) {
                createPagination(paginationBottomContainer);
            }

            // Ensure pagination is displayed correctly (even if there's only one page)
            paginationBottomContainer.style.display =
                totalPages > 1 || totalProperties > 0 ? "flex" : "none";
        }

        function applySort() {
            console.log("Applying sorting based on currentSort:", currentSort);

            // Update the currentSort based on the UI dropdown value
            const sortDropdown = document.getElementById("sortDropdown");
            if (sortDropdown) {
                currentSort = sortDropdown.value;
            }

            // Reset to the first page when sorting changes
            currentPage = 1;

            // Call displayResult to handle sorting, filtering, and rendering
            displayResult();
        }

        function toggleFilter(button, attribute, value) {
            // Toggle button's selected state
            let buttons = document.querySelectorAll(`button[id^=${attribute}]`);
            buttons.forEach(btn => {
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-light');
            });

            // Apply active state to the selected button
            if (currentFilter[attribute] === value) {
                delete currentFilter[attribute];  // Deselect the filter if already selected
            } else {
                currentFilter[attribute] = value;  // Apply the new filter
                button.classList.add('btn-secondary');
                button.classList.remove('btn-light');
            }

            currentPage = 1;  // Reset to the first page when applying a new filter
            displayResult();
        }

        function clearFilters() {
            // Step 1: Clear all filter criteria from the currentFilter object
            currentFilter = {};

            // Step 2: Reset all filter buttons to their default (inactive) state
            let buttons = document.querySelectorAll('button.btn-secondary');
            buttons.forEach(btn => {
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-light');
            });

            // Step 3: Optionally reset the sorting dropdown (if you want to reset sorting)
            const sortDropdown = document.getElementById('sortDropdown');
            if (sortDropdown) {
                sortDropdown.value = 'none';  // Assuming 'none' is the default option
                currentSort = 'none';  // Reset the global sorting state
            }

            // Step 3.5: Reset the province dropdown to "all" (All provinces)
            const provinceDropdown = document.getElementById('provinceFilter');
            if (provinceDropdown) {
                provinceDropdown.value = 'all';
            }

            // Step 3.6: Clear the reference textbox
            const refTextbox = document.getElementById('refSearch');
            if (refTextbox) {
                refTextbox.value = '';
            }
            // Step 4: Reset pagination to the first page
            currentPage = 1;

            // Step 5: Call displayResult to refresh the view with no filters applied
            displayResult();

            // Optional Step 6: Update the pagination controls or any other visual indicators if necessary
            // updatePaginationControls();
        }

        function initializeCarousels() {
            // Select all carousel elements
            const carousels = document.querySelectorAll('.carousel');

            carousels.forEach(carousel => {
                // Check if the carousel is already initialized by Bootstrap
                if (!bootstrap.Carousel.getInstance(carousel)) {
                    // Initialize the carousel
                    new bootstrap.Carousel(carousel);
                }
            });
        }

        function attachCarouselListeners() {
            // Add event listener for next buttons
            document.body.addEventListener('click', function (e) {
                const nextButton = e.target.closest('.carousel-control-next');
                if (nextButton) {
                    e.preventDefault(); // Prevent default link behavior
                    const carouselId = nextButton.getAttribute('data-bs-target').replace('#', ''); // Extract the ID without the '#'
                    const carouselElement = document.getElementById(carouselId); // Get the carousel element by ID
                    if (carouselElement) {
                        const carouselInstance = bootstrap.Carousel.getInstance(carouselElement);
                        if (carouselInstance) {
                            carouselInstance.next(); // Trigger 'next' on the carousel
                        }
                    }
                }
            });

            // Add event listener for prev buttons
            document.body.addEventListener('click', function (e) {
                const prevButton = e.target.closest('.carousel-control-prev');
                if (prevButton) {
                    e.preventDefault(); // Prevent default link behavior
                    const carouselId = prevButton.getAttribute('data-bs-target').replace('#', ''); // Extract the ID without the '#'
                    const carouselElement = document.getElementById(carouselId); // Get the carousel element by ID
                    if (carouselElement) {
                        const carouselInstance = bootstrap.Carousel.getInstance(carouselElement);
                        if (carouselInstance) {
                            carouselInstance.prev(); // Trigger 'prev' on the carousel
                        }
                    }
                }
            });
        }
        
        function attachModalListeners() {
            // Add event listener for "More Information" buttons
            document.body.addEventListener('click', function (e) {
                const moreInfoButton = e.target.closest('.more-info-btn, .contact-btn');
                if (moreInfoButton) {
                    e.preventDefault(); // Prevent default button behavior
                    const modalId = moreInfoButton.getAttribute('data-bs-target').replace('#', ''); // Extract modal ID
                    const modalElement = document.getElementById(modalId); // Get the modal element by ID
                    if (modalElement) {
                        const modalInstance = new bootstrap.Modal(modalElement); // Initialize the Bootstrap modal
                        modalInstance.show(); // Show the modal
                    }
                }
            });
        }

        function updateRefFilter(element) {
            // Trim whitespace and update the filter for the reference search
            currentFilter.ref = element.value.trim();
            displayResult();
        }
                
        function populateProvinceDropdown() {
            const dropdown = document.getElementById("provinceFilter");
            if (!dropdown) return;
            
            // Clear existing options, if any
            dropdown.innerHTML = "";

            // Add the default "Alle Regio's" option
            const defaultOption = document.createElement("option");
            defaultOption.value = "all";
            defaultOption.textContent = "Alle Regio's";
            dropdown.appendChild(defaultOption);

            // Ensure cachedProperties is available and is an array
            if (cachedProperties && Array.isArray(cachedProperties)) {
                // Use a Map to gather unique province values ignoring capitalization differences.
                // The key is the province in lower-case, and the value is the original province string.
                const provincesMap = new Map();
                cachedProperties.forEach(property => {
                    if (property.province) {
                        const normalizedProvince = property.province.toLowerCase();
                        if (!provincesMap.has(normalizedProvince)) {
                            provincesMap.set(normalizedProvince, property.province);
                        }
                    }
                });

                // Convert the Map values to an array, sort them ignoring case, and create an <option> for each province.
                const provincesArray = Array.from(provincesMap.values()).sort((a, b) =>
                    a.toLowerCase().localeCompare(b.toLowerCase())
                );
                
                provincesArray.forEach(province => {
                    const option = document.createElement("option");
                    option.value = province;
                    option.textContent = province;
                    dropdown.appendChild(option);
                });
            }
        }


        function updateProvinceFilter(element) {
            // Update the currentFilter with the selected province.
            // If "all" is selected, you may choose to remove or ignore the province filter.
            currentFilter.province = element.value;
            displayResult();
        }

        function validateContactForm() {
            const form = document.getElementById('contactFormHousing');

            // Check if the form is valid using the built-in HTML5 validation API
            if (!form.checkValidity()) {
                form.classList.add('was-validated'); // Bootstrap styling for invalid forms
                return false; // Prevent form submission
            }

            // If valid, proceed with form submission
            return true;
        }
    </script>
</body>
</html>